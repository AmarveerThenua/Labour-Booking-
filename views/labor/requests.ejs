<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Labor Booking - Requests</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<body>

  <!-- Flash Messages -->
  <div class="container">
    <% if (success && success.length> 0) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= success %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      <% } %>

        <% if (error && error.length> 0) { %>
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <%= error %>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          <% } %>
  </div>

<style>
  body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }
  .labor-container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    margin: 20px auto;
    max-width: 1100px;
    padding: 40px 30px 30px 30px;
  }
  .stats-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: none;
    margin-bottom: 20px;
    height: 100%;
  }
  .stats-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
  }
</style>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);">
    <div class="container-fluid px-3">
        <a class="navbar-brand" href="/labor/home">
            <i class="bi bi-tools me-1"></i>Dashboard
        </a>
        
        <!-- Desktop Navigation -->
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav align-items-center">
                <li class="nav-item">
                    <a class="nav-link" href="/labor/profile">
                        <i class="bi bi-person-circle me-1"></i>Profile
                    </a>
                </li>
                <!-- Desktop Profile Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <% if (labor.profileImage) { %>
                            <img src="<%= labor.profileImage %>" alt="Profile" class="rounded-circle me-2" style="width: 32px; height: 32px; object-fit: cover;">
                        <% } else { %>
                            <div class="rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; background: rgba(255,255,255,0.2);">
                                <i class="bi bi-person text-white" style="font-size: 0.9rem;"></i>
                            </div>
                        <% } %>
                        <span class="text-white"><%= labor.user.name %></span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <a class="dropdown-item" href="/labor/profile">
                                <i class="bi bi-person-circle me-2"></i>Profile
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="/labor/dashboard">
                                <i class="bi bi-gear me-2"></i>Settings
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="/logout">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="labor-container">
  <div class="mb-4">
    <h2 class="fw-bold text-primary mb-0">Booking Requests</h2>
  </div>

  <% if (bookings.length === 0) { %>
    <div class="alert alert-info">No booking requests at the moment.</div>
  <% } else { %>
    <div class="row g-4">
      <% bookings.forEach(b => { %>
        <div class="col-12 col-md-6 col-lg-4">
          <div class="stats-card h-100">
            <div class="d-flex flex-column align-items-center">
              <div class="mb-3">
                <% if (b.user && b.user.profileImage) { %>
                  <img src="<%= b.user.profileImage %>" alt="User" class="rounded-circle border border-3 border-light" style="width:70px;height:70px;object-fit:cover;">
                <% } else { %>
                  <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" style="width:70px;height:70px;">
                    <i class="bi bi-person text-secondary" style="font-size:2.2rem;"></i>
                  </div>
                <% } %>
              </div>
              <h5 class="mb-1"><%= b.user?.name || 'N/A' %></h5>
              <div class="text-muted mb-2" style="font-size:0.98rem;">Mobile: <%= b.user?.mobile || 'N/A' %></div>
              <div class="mb-2"><i class="bi bi-calendar me-1"></i> <%= b.date.toLocaleDateString() %></div>
              <div class="mb-3">
                <% if (b.status === 'Pending') { %>
                  <span class="badge bg-warning text-dark px-3 py-2">Pending</span>
                <% } else if (b.status === 'Accepted') { %>
                  <span class="badge bg-success px-3 py-2">Accepted</span>
                <% } else if (b.status === 'Completed') { %>
                  <span class="badge bg-primary px-3 py-2">Completed</span>
                <% } else if (b.status === 'Rejected') { %>
                  <span class="badge bg-danger px-3 py-2">Rejected</span>
                <% } else { %>
                  <span class="badge bg-secondary px-3 py-2">Other</span>
                <% } %>
              </div>
              <div class="w-100 mt-auto">
                <% if (b.status === 'Pending') { %>
                  <form method="POST" action="/labor/accept/<%= b._id %>" class="d-grid mb-2">
                    <button type="submit" class="btn btn-success w-100 mb-2"><i class="bi bi-check-lg me-1"></i>Accept</button>
                  </form>
                  <form method="POST" action="/labor/reject/<%= b._id %>" class="d-grid">
                    <button type="submit" class="btn btn-danger w-100"><i class="bi bi-x-lg me-1"></i>Decline</button>
                  </form>
                <% } else if (b.status === 'Accepted') { %>
                  <form method="POST" action="/labor/complete/<%= b._id %>" class="d-grid">
                    <button type="submit" class="btn btn-primary w-100"><i class="bi bi-award me-1"></i>Complete</button>
                  </form>
                <% } else { %>
                  <div class="text-center text-muted">No actions</div>
                <% } %>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const currentLaborId = "<%= userId %>";

  socket.on("newBookingRequest", (data) => {
    if (data.laborUserId === currentLaborId) {
      alert(data.message);
      location.reload();
    }
  });
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
